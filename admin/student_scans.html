<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <meta name="robots" content="noindex,nofollow">

  <!-- COPY THESE TWO META TAGS FROM hallway.html (same pattern as other pages) -->
  <meta name="api-base" content="https://red-cake-77d5.evazquez-3e0.workers.dev/" />
  <meta name="google-client-id" content="690302076971-cmclpgcqko4lhuaetbeacu00ptl9jc4m.apps.googleusercontent.com" />

  <title>Student Scan Report</title>
  <link rel="stylesheet" href="./admin.css" />

  <!-- Google Identity Services (same pattern as other admin pages) -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <link rel="stylesheet" href="./nav.css">
  <script src="./nav.js" defer></script>

  <style>
    .row { display:flex; gap:10px; flex-wrap:wrap; align-items:end; }
    .row > * { flex: 0 0 auto; }
    .grow { flex: 1 1 auto; min-width: 260px; }
    .kpi { display:grid; grid-template-columns: repeat(4, minmax(160px, 1fr)); gap:10px; }
    @media (max-width: 900px){ .kpi { grid-template-columns: repeat(2, minmax(160px, 1fr)); } }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .small { font-size: 12px; color: #5e6b7a; }
    table td, table th { vertical-align: top; }

    /* --- Print helpers --- */
    @media print {
      html, body {
        background: #fff !important;
        color: #000 !important;
      }

      /* Kill dark cards/gradients/shadows from admin.css */
      .card, #appCard, #loginCard {
        background: #fff !important;
        color: #000 !important;
        box-shadow: none !important;
      }

      /* Prevent random dark boxes from overlays/shadows */
      *, *::before, *::after {
        box-shadow: none !important;
        text-shadow: none !important;
        background-image: none !important;
      }

      /* Just in case the busy overlay ever exists */
      #busyOverlay { display: none !important; }

      /* hide controls + debug */
      .topbar { display: none !important; }
      .no-print { display: none !important; }

      /* hide the whole Raw Scans section */
      #rawSection { display: none !important; }

      /* make the card print cleanly */
      .wrap { max-width: none !important; padding: 0 !important; }
      #appCard { box-shadow: none !important; border: none !important; background: transparent !important; }

      /* tables print nicely */
      table { width: 100% !important; border-collapse: collapse !important; }
      th, td { border: 1px solid #ddd !important; padding: 6px 8px !important; }
      thead { display: table-header-group; }
      tr { page-break-inside: avoid; }

      /* KPI grid prints better */
      .kpi { grid-template-columns: repeat(2, minmax(160px, 1fr)) !important; gap: 8px !important; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="topbar">
      <div>
        <div style="font-weight:700;">Student Scan Report</div>
        <div class="small">Scans sheet = source of truth</div>
      </div>
    </header>

    <!-- LOGIN CARD -->
    <section class="card" id="loginCard" style="display:none;">
      <h3>Sign in</h3>
      <div id="g_id_signin"></div>
      <pre class="mono small" id="loginOut"></pre>
    </section>

    <!-- APP -->
    <section class="card" id="appCard" style="display:none;">
      <div class="row no-print">
        <div class="grow">
          <label>Student</label><br/>
          <input class="grow"
                id="studentSearch"
                placeholder="Start typing name or OSIS..."
                list="studentDatalist"
                autocomplete="off" />
          <datalist id="studentDatalist"></datalist>

          <!-- holds the chosen OSIS -->
          <input type="hidden" id="studentOsis" />
          <div class="small" id="studentPickHint" style="margin-top:6px;"></div>
        </div>

        <div>
          <label>Start</label><br/>
          <input type="date" id="startDate" />
        </div>
        <div>
          <label>End</label><br/>
          <input type="date" id="endDate" />
        </div>
        <div>
          <div style="display:flex; gap:8px;">
            <button class="btn" id="btnRun" type="button">Run</button>
            <button class="btn ghost" id="btnPrint" type="button">Print</button>
          </div>
        </div>
      </div>

      <hr/>

      <div id="printArea">
        <div class="print-only" style="font-weight:700; font-size:18px; margin-bottom:8px;">
          Student Scan Report
        </div>

        <div id="studentHeader" style="margin-bottom:10px;"></div>

        <div class="kpi" id="kpiGrid"></div>

      <h3>Bathroom sessions (paired IN â†’ OUT)</h3>
      <div id="bathSummary" class="small"></div>
      <div style="overflow:auto;">
        <table id="bathByPeriod" style="width:100%; margin-top:8px;">
          <thead>
            <tr>
              <th>Period</th>
              <th>Sessions</th>
              <th>Total minutes</th>
              <th>Avg minutes</th>
              <th>Missing OUT</th>
              <th>Missing IN</th>
              <th>Manual clears</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <h3>Courses overview</h3>
      <div id="coursesSummary" class="small"></div>
      <div style="overflow:auto;">
        <table id="coursesTable" style="width:100%; margin-top:8px;">
          <thead>
            <tr>
              <th>Course / Advisor</th>
              <th>Period(s)</th>
              <th>Scans</th>
              <th>Bathroom sessions</th>
              <th>Bathroom minutes</th>
              <th>Denied</th>
              <th>First scan</th>
              <th>Last scan</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <h3>Morning first scan</h3>
      <div id="morningTableWrap" style="overflow:auto;"></div>


      <div id="rawSection">
        <h3>Raw scans</h3>
        <pre class="mono small" id="rawMeta"></pre>
        <div style="overflow:auto;">
          <table id="rawTable" style="width:100%;">
            <thead>
              <tr>
                <th>When</th>
                <th>Location</th>
                <th>Allowed</th>
                <th>Class</th>
                <th>Period</th>
                <th>Source</th>
                <th>Device</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <pre class="mono small no-print" id="out"></pre>
      </div>
    </section>
  </div>

  <script src="./student_scans.js"></script>
</body>
</html>