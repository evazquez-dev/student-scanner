<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <meta name="robots" content="noindex,nofollow">

  <!-- COPY THESE TWO META TAGS FROM hallway.html (same pattern as other pages) -->
  <meta name="api-base" content="https://red-cake-77d5.evazquez-3e0.workers.dev/" />
  <meta name="google-client-id" content="690302076971-cmclpgcqko4lhuaetbeacu00ptl9jc4m.apps.googleusercontent.com" />

  <title>Student Scan Report</title>
  <link rel="stylesheet" href="./admin.css" />

  <!-- Google Identity Services (same pattern as other admin pages) -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <style>
    .row { display:flex; gap:10px; flex-wrap:wrap; align-items:end; }
    .row > * { flex: 0 0 auto; }
    .grow { flex: 1 1 auto; min-width: 260px; }
    .kpi { display:grid; grid-template-columns: repeat(4, minmax(160px, 1fr)); gap:10px; }
    @media (max-width: 900px){ .kpi { grid-template-columns: repeat(2, minmax(160px, 1fr)); } }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .small { font-size: 12px; color: #5e6b7a; }
    table td, table th { vertical-align: top; }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="topbar">
      <div>
        <div style="font-weight:700;">Student Scan Report</div>
        <div class="small">Scans sheet = source of truth</div>
      </div>
      <div class="rowBtns">
        <a class="btn ghost" href="./admin.html">Admin</a>
        <button class="btn ghost" id="btnLogout" type="button">Logout</button>
      </div>
    </header>

    <!-- LOGIN CARD -->
    <section class="card" id="loginCard" style="display:none;">
      <h3>Sign in</h3>
      <div id="g_id_signin"></div>
      <pre class="mono small" id="loginOut"></pre>
    </section>

    <!-- APP -->
    <section class="card" id="appCard" style="display:none;">
      <div class="row">
        <div class="grow">
          <label>Student</label><br/>
          <input class="grow" id="studentSearch" placeholder="Type to filter (name or OSIS)..." />
          <select class="grow" id="studentSelect" size="10" style="width:100%; margin-top:6px;"></select>
        </div>

        <div>
          <label>Start</label><br/>
          <input type="date" id="startDate" />
        </div>
        <div>
          <label>End</label><br/>
          <input type="date" id="endDate" />
        </div>
        <div>
          <button class="btn" id="btnRun" type="button">Run</button>
        </div>
      </div>

      <hr/>

      <div id="studentHeader" style="margin-bottom:10px;"></div>

      <div class="kpi" id="kpiGrid"></div>

      <h3>Bathroom sessions (paired IN â†’ OUT)</h3>
      <div id="bathSummary" class="small"></div>
      <div style="overflow:auto;">
        <table id="bathByPeriod" style="width:100%; margin-top:8px;">
          <thead>
            <tr>
              <th>Period</th>
              <th>Sessions</th>
              <th>Total minutes</th>
              <th>Avg minutes</th>
              <th>Missing OUT</th>
              <th>Missing IN</th>
              <th>Manual clears</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <h3>Morning first scan</h3>
      <div id="morningTableWrap" style="overflow:auto;"></div>

      <h3>Raw scans</h3>
      <pre class="mono small" id="rawMeta"></pre>
      <div style="overflow:auto;">
        <table id="rawTable" style="width:100%;">
          <thead>
            <tr>
              <th>When</th>
              <th>Location</th>
              <th>Allowed</th>
              <th>Class</th>
              <th>Period</th>
              <th>Source</th>
              <th>Device</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <pre class="mono small" id="out"></pre>
    </section>
  </div>

  <script src="./student_scans.js"></script>
</body>
</html>