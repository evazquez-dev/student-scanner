<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="robots" content="noindex,nofollow">
  <!-- Set your Worker URL here (edit only the content attribute) -->
  <meta name="api-base" content="https://red-cake-77d5.evazquez-3e0.workers.dev/">
  <meta name="google-client-id" content="YOUR_GOOGLE_WEB_CLIENT_ID.apps.googleusercontent.com">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <title>Student Scanner — Admin</title>
  <link rel="stylesheet" href="./admin.css">
</head>
<body>
  <main class="wrap">
    <header>
      <h1>Student Scanner — Admin</h1>
      <p class="muted">Signed in with Google; actions require admin role.</p>
    </header>
    <div id="loginCard" class="card" style="display:none; text-align:center;">
      <h2>Admin sign in</h2>
      <p class="muted">Sign in with your school Google account.</p>
      <div id="g_id_signin"></div>
      <pre id="loginOut" class="pane">—</pre>
    </div>
    <section class="card" id="diagCard">
      <h2>Diagnostics</h2>
      <div class="row">
        <div class="col">
          <label>API base (from meta)</label>
          <div id="apiBase" class="mono"></div>
        </div>
        <div class="col right">
          <button id="btnPing" class="btn">Ping Worker</button>
          <button id="btnDiag" class="btn ghost">Fetch /admin/diag (token)</button>
        </div>
      </div>
      <pre id="diagOut" class="pane">—</pre>
    </section>

    <section class="card" id="rosterCard">
      <h2>Roster</h2>
      <div class="row">
        <div class="col">
          <div class="muted">Trigger a full sync (GAS → Worker KV). This runs the same `/admin/sync` your GAS menu calls.</div>
        </div>
        <div class="col right">
          <button id="btnSync" class="btn primary">Sync now (admin token)</button>
        </div>
      </div>
      <pre id="syncOut" class="pane">—</pre>
    </section>

    <section class="card" id="locationsCard">
      <h2>Locations</h2>
      <div class="muted">Edit the list, then push to Worker via <code>/admin/push_locations</code>.</div>
      <textarea id="locationsEditor" placeholder="One location per line" rows="6"></textarea>
      <div class="row" style="gap:8px;margin-top:8px;">
        <button id="btnLoadLocations" class="btn">Load from Worker</button>
        <button id="btnPushLocations" class="btn primary">Push to Worker (admin token)</button>
        <button id="btnResetLocations" class="btn ghost">Reset editor</button>
      </div>
      <pre id="locationsOut" class="pane">—</pre>
    </section>

    <section class="card" id="bathCard">
      <h2>Bathroom capacity</h2>
      <div class="muted">Quickly set cap for a bathroom location via <code>/admin/bath_cap</code>.</div>

      <div class="row" style="align-items:center; gap:8px; margin-top:8px;">
        <input id="bathLocation" placeholder="Bathroom (First Floor)" />
        <input id="bathCap" type="number" min="1" placeholder="cap (e.g. 2)" style="width:120px" />
        <button id="btnSetBathCap" class="btn primary">Set cap (admin token)</button>
        <button id="btnGetBathCap" class="btn ghost">Get cap</button>
      </div>

      <pre id="bathOut" class="pane">—</pre>
    </section>

    <section class="card" id="bindCard">
      <h2>Device binding</h2>
      <div class="muted">Bind/unbind devices to locations.</div>
      <div class="row" style="gap:8px; align-items:center; margin-top:8px;">
        <input id="bindDeviceId" placeholder="device id (UUID)" />
        <input id="bindLocation" placeholder="location (exact)" />
        <button id="btnBind" class="btn">Bind (admin token)</button>
        <button id="btnUnbind" class="btn ghost">Unbind (admin token)</button>
      </div>
      <pre id="bindOut" class="pane">—</pre>
    </section>

    <footer style="margin-top:20px">
      <small class="muted">When you switch to a proper auth method (Google Sign-In / Cloudflare Access) we will remove the token prompt and use session cookies instead.</small>
    </footer>
  </main>

  <script src="./admin.js" type="module"></script>
</body>
</html>
