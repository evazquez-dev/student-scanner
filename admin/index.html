<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="robots" content="noindex,nofollow">
  <!-- Set your Worker URL here (edit only the content attribute) -->
  <meta name="api-base" content="https://red-cake-77d5.evazquez-3e0.workers.dev/">
  <meta name="google-client-id" content="690302076971-cmclpgcqko4lhuaetbeacu00ptl9jc4m.apps.googleusercontent.com">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <title>Student Scanner — Admin</title>
  <link rel="stylesheet" href="./admin.css">
</head>
<body>
  <main class="wrap">
    <header>
      <h1>Student Scanner — Admin</h1>
      <p class="muted">Signed in with Google; actions require admin role.</p>
    </header>

    <!-- Login -->
    <div id="loginCard" class="card" style="display:none; text-align:center;">
      <h2>Admin sign in</h2>
      <p class="muted">Sign in with your school Google account.</p>
      <div id="g_id_signin"></div>
      <pre id="loginOut" class="pane">—</pre>
    </div>

    <!-- Diagnostics -->
    <section class="card" id="diagCard">
      <h2>Diagnostics</h2>
      <div class="row">
        <div class="col">
          <label>API base (from meta)</label>
          <div id="apiBase" class="mono"></div>
        </div>
        <div class="col right">
          <button id="btnPing" class="btn">Ping Worker</button>
          <button id="btnDiag" class="btn ghost">Fetch /admin/diag (session)</button>
        </div>
      </div>
      <pre id="diagOut" class="pane">—</pre>
    </section>

    <!-- Roster -->
    <section class="card" id="rosterCard">
      <h2>Roster</h2>
      <div class="row">
        <div class="col">
          <div class="muted">Trigger a full sync (GAS → Worker KV). This runs the same <code>/admin/sync</code> your GAS menu calls.</div>
        </div>
        <div class="col right">
          <button id="btnSync" class="btn primary">Sync now (session)</button>
        </div>
      </div>
      <pre id="syncOut" class="pane">—</pre>
    </section>

    <!-- Locations -->
    <section class="card" id="locationsCard">
      <h2>Locations</h2>
      <div class="muted">Edit the list, then push to Worker via <code>/admin/push_locations</code>.</div>
      <textarea id="locationsEditor" placeholder="One location per line" rows="6"></textarea>
      <div class="row" style="gap:8px;margin-top:8px;">
        <button id="btnLoadLocations" class="btn">Load from Worker</button>
        <button id="btnPushLocations" class="btn primary">Push to Worker (session)</button>
        <button id="btnResetLocations" class="btn ghost">Reset editor</button>
      </div>
      <pre id="locationsOut" class="pane">—</pre>
    </section>

    <!-- Bathroom capacity: quick set -->
    <section class="card" id="bathCard">
      <h2>Bathroom capacity</h2>
      <div class="muted">
        Quickly view and set caps for bathrooms (ALL / M / F) via <code>/admin/bath_cap</code>.
        Use the selector to load a bathroom into the quick-set controls, or edit directly in the table below.
      </div>
    
      <!-- Quick select + get/set -->
      <div class="row" style="align-items:center; gap:8px; margin-top:12px;">
        <select id="bathSelect" style="min-width:260px">
          <option value="">(Loading bathrooms…)</option>
        </select>
    
        <input id="bathCapAll" type="number" min="1" placeholder="ALL cap" style="width:120px" />
        <button id="btnBathSetAll" class="btn">Set ALL</button>
    
        <input id="bathCapM" type="number" min="1" placeholder="M cap" style="width:120px" />
        <button id="btnBathSetM" class="btn">Set M</button>
    
        <input id="bathCapF" type="number" min="1" placeholder="F cap" style="width:120px" />
        <button id="btnBathSetF" class="btn">Set F</button>
    
        <button id="btnBathGetSelected" class="btn ghost">Load caps</button>
        <button id="btnBathLoadTable" class="btn ghost">Reload table</button>
      </div>
    
      <pre id="bathOut" class="pane">—</pre>
    
      <!-- Table -->
      <div style="overflow:auto; margin-top:10px;">
        <table style="width:100%; border-collapse:separate; border-spacing:0 6px;">
          <thead>
            <tr style="text-align:left; font-size:13px; color:#667;">
              <th>Bathroom</th>
              <th>ALL</th>
              <th>M</th>
              <th>F</th>
              <th style="width:260px">Actions</th>
            </tr>
          </thead>
          <tbody id="bathTbody">
            <!-- rows injected by JS -->
          </tbody>
        </table>
      </div>
    
      <pre id="bathTableOut" class="pane">—</pre>
    </section>


    <!-- Bathroom capacity: table -->
    <section class="card" id="bathTableCard">
      <h2>Bathroom capacity — table</h2>
      <div class="row" style="gap:8px; align-items:center;">
        <button id="btnBathLoadTable" class="btn">Reload caps</button>
      </div>
      <div class="tableWrap">
        <table id="bathTbl">
          <thead>
            <tr>
              <th>Location</th>
              <th>ALL cap</th>
              <th>M cap</th>
              <th>F cap</th>
              <th style="width:180px">Actions</th>
            </tr>
          </thead>
          <tbody id="bathTbody"></tbody>
        </table>
      </div>
      <pre id="bathTableOut" class="pane">—</pre>
    </section>

    <!-- Device binding -->
    <section class="card" id="bindCard">
      <h2>Device binding</h2>
      <div class="muted">Bind/unbind devices to locations.</div>
      <div class="row" style="gap:8px; align-items:center; margin-top:8px;">
        <input id="bindDeviceId" placeholder="device id (UUID)" />
        <input id="bindLocation" placeholder="location (exact)" />
        <button id="btnBind" class="btn">Bind (session)</button>
        <button id="btnUnbind" class="btn ghost">Unbind (session)</button>
      </div>
      <pre id="bindOut" class="pane">—</pre>
    </section>

    <footer style="margin-top:20px">
      <small class="muted">This page uses Google Sign-In → session cookie with your Worker. No tokens in the browser UI.</small>
    </footer>
  </main>

  <script src="./admin.js" type="module"></script>
</body>
</html>
